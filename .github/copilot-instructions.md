# ChatGPT Apps SDK Example - Copilot Instructions

This is a Node.js TypeScript project that implements a ChatGPT App with an MCP (Model Context Protocol) server for personal website integration. The server scrapes blog posts and provides tools that can be used within ChatGPT.

## Code Standards

### Required Before Each Commit
- Run `npm run build` before committing to ensure TypeScript compiles and widgets are built correctly
- This command runs both TypeScript compilation (`tsc`) and widget bundling (`build-widget.mjs`)

### Development Flow
- **Install dependencies**: `npm install`
- **Build**: `npm run build` (compiles TypeScript and builds widgets)
- **Development mode**: `npm run dev` (runs server with hot reload using tsx)
- **Start server**: `npm start` (runs the compiled server)
- **Test**: `node test-server.mjs` (tests MCP server functionality)
- **Serve static assets**: `npm run serve` (starts HTTP server on port 4444 for widget assets)

## Repository Structure

- `src/`: TypeScript source files
  - `src/server.ts`: Main MCP server implementation with tool definitions
  - `src/widgets/`: HTML widget files for ChatGPT UI components
- `dist/`: Compiled JavaScript output (generated by TypeScript)
- `assets/`: Built widget assets (generated by Vite)
- `test-server.mjs`: Test script for validating MCP server functionality
- `build-widget.mjs`: Script for building widget HTML/CSS/JS bundles
- `package.json`: Dependencies and npm scripts
- `tsconfig.json`: TypeScript configuration
- `vite.config.mts`: Vite configuration for widget bundling

## Key Guidelines

1. **TypeScript**: Use strict TypeScript with proper type safety. Target is ES2022.
2. **MCP Protocol**: Follow MCP SDK patterns for server, tools, and request handling
3. **Error Handling**: Always use try-catch blocks with proper error type checking (`error instanceof Error`)
4. **Tool Definitions**: Each MCP tool must have:
   - `name`: Tool identifier
   - `description`: Clear description of what the tool does
   - `inputSchema`: JSON schema defining input parameters with types and descriptions
5. **Widget Development**: Widgets are standalone HTML files with inline CSS and JavaScript
6. **Dependencies**: Keep dependencies minimal. Current runtime dependencies are:
   - `@modelcontextprotocol/sdk` - MCP server implementation
   - `cheerio` - HTML parsing for web scraping
7. **Testing**: Use the test-server.mjs script to validate changes to MCP tools
8. **Documentation**: Update README.md and related docs when adding new features or tools

## MCP Server Conventions

- Server runs on stdio transport (standard input/output)
- Tools return responses with `content` array containing text or resource objects
- Widget metadata is included in `_meta['openai/outputTemplate']` field
- Error responses should include `isError: true` flag
- Use proper JSON-RPC request/response patterns

## Widget Guidelines

- Widgets are self-contained HTML files with inline CSS and JS
- Use ChatGPT's `window.openai` API for interactions
- Build widgets using Vite for proper bundling and optimization
- Widget HTML files go in `src/widgets/` directory
- Built widget assets are automatically placed in `assets/` directory

## Code Style

- Use meaningful variable names
- Add JSDoc comments for public functions and complex logic
- Follow existing code structure and patterns
- Use ES2022 features (async/await, optional chaining, etc.)
- Prefer `const` over `let` when variables don't need reassignment
